# Notes on filtering out snps based on minor allele frequency, checking LD decay, LD-pruning, examining kinship, filtering out select individuals, and converting file format

vcftools --gzvcf BOW_SNPS.filter1.miss.biallel.min100kb.autosomes.vcf.gz --maf 0.05 --recode --recode-INFO-all --out NAR_SNPS.filter1.miss.biallel.min100kb.autosomes.maf05

# PopLDdecay
/home/degreefe/programs/PopLDdecay/bin/PopLDdecay -InVCF BOW_SNPS.filter1.miss.biallel.min100kb.maf05.vcf.gz -OutStat LDdecay
/home/degreefe/programs/PopLDdecay/bin/Plot_OnePop.pl -inFile LDdecay.stat.gz -output LDdeayFig

# Run LD_pruning.sh file
./LD_pruning.sh BOW_SNPS.filter1.miss.biallel.min100kb.maf05

# Prep files for kinship analysis
/home/degreefe/programs/plink --allow-extra-chr --make-bed --vcf BOW_SNPS.filter1.miss.biallel.min100kb.maf05.LDprunedr08.vcf --set-missing-var-ids @:#\$1,\$2 --out BOW_SNPS.filter1.miss.biallel.min100kb.maf05.LDprunedr08 --double-id

# Run plink pairwise estimates, will use the .genome and .imiss files for plinkQC in R
/home/degreefe/programs/plink --allow-extra-chr --bfile BOW_SNPS.filter1.miss.biallel.min100kb.maf05.LDprunedr088 --double-id

/home/degreefe/programs/plink --allow-extra-chr --bfile BOW_SNPS.filter1.miss.biallel.min100kb.maf05.LDprunedr08 --missing --out BOW_SNPS.filter1.miss.biallel.min100kb.maf05.LDprunedr08 --double-id

# Look at these files in R with examine_kinship.R to determine which individuals are duplicates or kins

# Remove kin pair indiv
vcftools --gzvcf BOW_SNPS.filter1.miss.biallel.min100kb.autosomes.maf05.LDprunedr08.vcf.gz --remove-indv 99_01 --recode --recode-INFO-all --out BOW_SNPS.filter1.miss.biallel.min100kb.autosomes.maf05.LDprunedr08.n22

### For narwhal, remove duplicate and kin indiv
vcftools --gzvcf NAR_SNPS.filter1.miss.biallel.min100kb.autosomes.maf05.LDprunedr08.vcf.gz --remove-indv RA_HM_IQ_121 --remove-indv B96_393_SB --recode --recode-INFO-all --out NAR_SNPS.filter1.miss.biallel.min100kb.autosomes.maf05.LDprunedr08.n58
###

# Make bfile formats
/home/degreefe/programs/plink --allow-extra-chr --make-bed --vcf BOW_SNPS.filter1.miss.biallel.min100kb.autosomes.maf05.LDprunedr08.n22.vcf --set-missing-var-ids @:#\$1,\$2 --out BOW_SNPS.filter1.miss.biallel.min100kb.autosomes.maf05.LDprunedr08.n22 --double-id

# Also make ped format for LEA
/home/degreefe/programs/bcftools-1.9/bcftools view -H BOW_SNPS.filter1.miss.biallel.min100kb.autosomes.maf05.LDprunedr08.n22.vcf.gz | cut -f 1 | uniq | awk '{print $0"\t"$0}' > chrom-map.txt
vcftools --gzvcf BOW_SNPS.filter1.miss.biallel.min100kb.autosomes.maf05.LDprunedr08.n22.vcf.gz --plink --chrom-map chrom-map.txt --out BOW_SNPS.filter1.miss.biallel.min100kb.autosomes.maf05.LDprunedr08.n22